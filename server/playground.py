import cv2
import numpy as np
from PIL import Image, ImageDraw
import colorgram
from io import BytesIO
import os
from sklearn.cluster import KMeans

img_path = f"data/subset/photo_2023-05-29-19-51-04_jpeg.rf.da18962278da1f32caa5cf1d237f5309.jpg"


# Function to extract ROI
def extract_roi(data):
    # Get the points for the ROI
    points = data["predictions"][0]["points"]

    # Create an empty mask
    mask = Image.new(
        "L",
        (int(data["predictions"][0]["width"]), int(data["predictions"][0]["height"])),
        0,
    )
    draw = ImageDraw.Draw(mask)

    # Convert points to tuples
    points = [(int(point["x"]), int(point["y"])) for point in points]

    # Draw polygon on the mask
    draw.polygon(points, fill=255)

    # Get the bounding box of the mask
    bbox = mask.getbbox()

    # Crop the original image using the bounding box
    roi = Image.open(img_path)  # Replace with the path to your original image
    roi = roi.crop(bbox)

    return roi


# Function to get dominant color
def get_dominant_color(image):
    colors = colorgram.extract(image, 1)
    dominant_color = colors[0].rgb
    return dominant_color


# Usage
segmentation_data = {
    "predictions": [
        {
            "x": 741.0,
            "y": 675.0,
            "width": 572.0,
            "height": 684.0,
            "confidence": 0.988563060760498,
            "class": "sneaker",
            "points": [
                {"x": 958.0, "y": 334.0},
                {"x": 952.0, "y": 340.0},
                {"x": 952.0, "y": 348.0},
                {"x": 948.0, "y": 352.0},
                {"x": 946.0, "y": 352.0},
                {"x": 944.0, "y": 354.0},
                {"x": 944.0, "y": 356.0},
                {"x": 938.0, "y": 362.0},
                {"x": 936.0, "y": 360.0},
                {"x": 926.0, "y": 360.0},
                {"x": 924.0, "y": 358.0},
                {"x": 922.0, "y": 358.0},
                {"x": 920.0, "y": 356.0},
                {"x": 920.0, "y": 354.0},
                {"x": 918.0, "y": 354.0},
                {"x": 916.0, "y": 352.0},
                {"x": 914.0, "y": 352.0},
                {"x": 910.0, "y": 348.0},
                {"x": 910.0, "y": 346.0},
                {"x": 908.0, "y": 344.0},
                {"x": 906.0, "y": 344.0},
                {"x": 902.0, "y": 340.0},
                {"x": 902.0, "y": 338.0},
                {"x": 900.0, "y": 336.0},
                {"x": 884.0, "y": 336.0},
                {"x": 880.0, "y": 340.0},
                {"x": 880.0, "y": 356.0},
                {"x": 876.0, "y": 360.0},
                {"x": 866.0, "y": 360.0},
                {"x": 860.0, "y": 354.0},
                {"x": 856.0, "y": 354.0},
                {"x": 854.0, "y": 352.0},
                {"x": 810.0, "y": 352.0},
                {"x": 808.0, "y": 354.0},
                {"x": 804.0, "y": 354.0},
                {"x": 800.0, "y": 358.0},
                {"x": 798.0, "y": 358.0},
                {"x": 796.0, "y": 360.0},
                {"x": 790.0, "y": 360.0},
                {"x": 788.0, "y": 362.0},
                {"x": 786.0, "y": 362.0},
                {"x": 780.0, "y": 368.0},
                {"x": 778.0, "y": 368.0},
                {"x": 770.0, "y": 376.0},
                {"x": 766.0, "y": 376.0},
                {"x": 764.0, "y": 378.0},
                {"x": 762.0, "y": 378.0},
                {"x": 756.0, "y": 384.0},
                {"x": 754.0, "y": 384.0},
                {"x": 748.0, "y": 390.0},
                {"x": 746.0, "y": 390.0},
                {"x": 742.0, "y": 394.0},
                {"x": 740.0, "y": 394.0},
                {"x": 732.0, "y": 402.0},
                {"x": 730.0, "y": 402.0},
                {"x": 724.0, "y": 408.0},
                {"x": 722.0, "y": 408.0},
                {"x": 720.0, "y": 410.0},
                {"x": 720.0, "y": 412.0},
                {"x": 716.0, "y": 416.0},
                {"x": 714.0, "y": 416.0},
                {"x": 710.0, "y": 420.0},
                {"x": 708.0, "y": 420.0},
                {"x": 696.0, "y": 432.0},
                {"x": 694.0, "y": 432.0},
                {"x": 692.0, "y": 434.0},
                {"x": 690.0, "y": 434.0},
                {"x": 690.0, "y": 436.0},
                {"x": 672.0, "y": 454.0},
                {"x": 672.0, "y": 456.0},
                {"x": 664.0, "y": 464.0},
                {"x": 664.0, "y": 466.0},
                {"x": 656.0, "y": 474.0},
                {"x": 656.0, "y": 480.0},
                {"x": 654.0, "y": 482.0},
                {"x": 654.0, "y": 486.0},
                {"x": 652.0, "y": 488.0},
                {"x": 652.0, "y": 490.0},
                {"x": 650.0, "y": 492.0},
                {"x": 650.0, "y": 502.0},
                {"x": 654.0, "y": 506.0},
                {"x": 654.0, "y": 508.0},
                {"x": 656.0, "y": 510.0},
                {"x": 656.0, "y": 514.0},
                {"x": 658.0, "y": 516.0},
                {"x": 658.0, "y": 518.0},
                {"x": 660.0, "y": 518.0},
                {"x": 664.0, "y": 522.0},
                {"x": 664.0, "y": 524.0},
                {"x": 666.0, "y": 526.0},
                {"x": 666.0, "y": 528.0},
                {"x": 668.0, "y": 530.0},
                {"x": 670.0, "y": 530.0},
                {"x": 672.0, "y": 532.0},
                {"x": 674.0, "y": 532.0},
                {"x": 682.0, "y": 540.0},
                {"x": 682.0, "y": 550.0},
                {"x": 680.0, "y": 552.0},
                {"x": 680.0, "y": 556.0},
                {"x": 678.0, "y": 558.0},
                {"x": 678.0, "y": 560.0},
                {"x": 674.0, "y": 564.0},
                {"x": 674.0, "y": 568.0},
                {"x": 672.0, "y": 570.0},
                {"x": 672.0, "y": 574.0},
                {"x": 670.0, "y": 576.0},
                {"x": 670.0, "y": 580.0},
                {"x": 668.0, "y": 582.0},
                {"x": 668.0, "y": 598.0},
                {"x": 670.0, "y": 600.0},
                {"x": 670.0, "y": 604.0},
                {"x": 666.0, "y": 608.0},
                {"x": 666.0, "y": 610.0},
                {"x": 662.0, "y": 614.0},
                {"x": 662.0, "y": 618.0},
                {"x": 658.0, "y": 622.0},
                {"x": 658.0, "y": 624.0},
                {"x": 654.0, "y": 628.0},
                {"x": 654.0, "y": 630.0},
                {"x": 650.0, "y": 634.0},
                {"x": 650.0, "y": 636.0},
                {"x": 646.0, "y": 640.0},
                {"x": 646.0, "y": 642.0},
                {"x": 640.0, "y": 648.0},
                {"x": 640.0, "y": 650.0},
                {"x": 638.0, "y": 652.0},
                {"x": 638.0, "y": 654.0},
                {"x": 632.0, "y": 660.0},
                {"x": 632.0, "y": 662.0},
                {"x": 624.0, "y": 670.0},
                {"x": 624.0, "y": 672.0},
                {"x": 608.0, "y": 688.0},
                {"x": 606.0, "y": 688.0},
                {"x": 576.0, "y": 718.0},
                {"x": 576.0, "y": 720.0},
                {"x": 574.0, "y": 722.0},
                {"x": 574.0, "y": 724.0},
                {"x": 568.0, "y": 730.0},
                {"x": 568.0, "y": 732.0},
                {"x": 560.0, "y": 740.0},
                {"x": 560.0, "y": 742.0},
                {"x": 548.0, "y": 754.0},
                {"x": 548.0, "y": 756.0},
                {"x": 544.0, "y": 760.0},
                {"x": 544.0, "y": 762.0},
                {"x": 536.0, "y": 770.0},
                {"x": 536.0, "y": 772.0},
                {"x": 530.0, "y": 778.0},
                {"x": 530.0, "y": 780.0},
                {"x": 526.0, "y": 784.0},
                {"x": 526.0, "y": 786.0},
                {"x": 510.0, "y": 802.0},
                {"x": 510.0, "y": 804.0},
                {"x": 506.0, "y": 808.0},
                {"x": 504.0, "y": 808.0},
                {"x": 496.0, "y": 816.0},
                {"x": 496.0, "y": 818.0},
                {"x": 488.0, "y": 826.0},
                {"x": 488.0, "y": 828.0},
                {"x": 484.0, "y": 832.0},
                {"x": 482.0, "y": 832.0},
                {"x": 482.0, "y": 834.0},
                {"x": 480.0, "y": 836.0},
                {"x": 480.0, "y": 838.0},
                {"x": 478.0, "y": 840.0},
                {"x": 478.0, "y": 842.0},
                {"x": 476.0, "y": 844.0},
                {"x": 476.0, "y": 846.0},
                {"x": 474.0, "y": 848.0},
                {"x": 474.0, "y": 850.0},
                {"x": 472.0, "y": 852.0},
                {"x": 472.0, "y": 856.0},
                {"x": 470.0, "y": 858.0},
                {"x": 470.0, "y": 860.0},
                {"x": 466.0, "y": 864.0},
                {"x": 466.0, "y": 866.0},
                {"x": 464.0, "y": 868.0},
                {"x": 464.0, "y": 876.0},
                {"x": 462.0, "y": 878.0},
                {"x": 462.0, "y": 880.0},
                {"x": 458.0, "y": 884.0},
                {"x": 458.0, "y": 892.0},
                {"x": 456.0, "y": 894.0},
                {"x": 456.0, "y": 908.0},
                {"x": 458.0, "y": 910.0},
                {"x": 458.0, "y": 926.0},
                {"x": 460.0, "y": 928.0},
                {"x": 460.0, "y": 936.0},
                {"x": 462.0, "y": 938.0},
                {"x": 462.0, "y": 942.0},
                {"x": 464.0, "y": 944.0},
                {"x": 464.0, "y": 948.0},
                {"x": 466.0, "y": 950.0},
                {"x": 466.0, "y": 952.0},
                {"x": 470.0, "y": 956.0},
                {"x": 470.0, "y": 958.0},
                {"x": 472.0, "y": 960.0},
                {"x": 472.0, "y": 964.0},
                {"x": 474.0, "y": 966.0},
                {"x": 476.0, "y": 966.0},
                {"x": 478.0, "y": 968.0},
                {"x": 478.0, "y": 970.0},
                {"x": 488.0, "y": 980.0},
                {"x": 488.0, "y": 982.0},
                {"x": 490.0, "y": 982.0},
                {"x": 498.0, "y": 990.0},
                {"x": 500.0, "y": 990.0},
                {"x": 504.0, "y": 994.0},
                {"x": 504.0, "y": 996.0},
                {"x": 506.0, "y": 996.0},
                {"x": 508.0, "y": 998.0},
                {"x": 512.0, "y": 998.0},
                {"x": 518.0, "y": 1004.0},
                {"x": 520.0, "y": 1004.0},
                {"x": 522.0, "y": 1006.0},
                {"x": 530.0, "y": 1006.0},
                {"x": 532.0, "y": 1008.0},
                {"x": 534.0, "y": 1008.0},
                {"x": 538.0, "y": 1012.0},
                {"x": 542.0, "y": 1012.0},
                {"x": 544.0, "y": 1014.0},
                {"x": 594.0, "y": 1014.0},
                {"x": 596.0, "y": 1012.0},
                {"x": 600.0, "y": 1012.0},
                {"x": 602.0, "y": 1010.0},
                {"x": 604.0, "y": 1010.0},
                {"x": 606.0, "y": 1008.0},
                {"x": 608.0, "y": 1008.0},
                {"x": 610.0, "y": 1006.0},
                {"x": 630.0, "y": 1006.0},
                {"x": 632.0, "y": 1004.0},
                {"x": 636.0, "y": 1004.0},
                {"x": 642.0, "y": 998.0},
                {"x": 652.0, "y": 998.0},
                {"x": 660.0, "y": 990.0},
                {"x": 668.0, "y": 990.0},
                {"x": 674.0, "y": 984.0},
                {"x": 676.0, "y": 984.0},
                {"x": 678.0, "y": 982.0},
                {"x": 684.0, "y": 982.0},
                {"x": 686.0, "y": 980.0},
                {"x": 688.0, "y": 980.0},
                {"x": 692.0, "y": 976.0},
                {"x": 694.0, "y": 976.0},
                {"x": 696.0, "y": 974.0},
                {"x": 700.0, "y": 974.0},
                {"x": 702.0, "y": 972.0},
                {"x": 702.0, "y": 970.0},
                {"x": 704.0, "y": 968.0},
                {"x": 706.0, "y": 968.0},
                {"x": 708.0, "y": 966.0},
                {"x": 714.0, "y": 966.0},
                {"x": 716.0, "y": 964.0},
                {"x": 718.0, "y": 964.0},
                {"x": 718.0, "y": 962.0},
                {"x": 722.0, "y": 958.0},
                {"x": 724.0, "y": 958.0},
                {"x": 726.0, "y": 956.0},
                {"x": 728.0, "y": 956.0},
                {"x": 732.0, "y": 952.0},
                {"x": 734.0, "y": 952.0},
                {"x": 736.0, "y": 950.0},
                {"x": 738.0, "y": 950.0},
                {"x": 740.0, "y": 948.0},
                {"x": 742.0, "y": 948.0},
                {"x": 742.0, "y": 946.0},
                {"x": 746.0, "y": 942.0},
                {"x": 748.0, "y": 942.0},
                {"x": 756.0, "y": 934.0},
                {"x": 758.0, "y": 934.0},
                {"x": 760.0, "y": 932.0},
                {"x": 760.0, "y": 930.0},
                {"x": 762.0, "y": 928.0},
                {"x": 764.0, "y": 928.0},
                {"x": 766.0, "y": 926.0},
                {"x": 766.0, "y": 924.0},
                {"x": 770.0, "y": 920.0},
                {"x": 772.0, "y": 920.0},
                {"x": 784.0, "y": 908.0},
                {"x": 786.0, "y": 908.0},
                {"x": 790.0, "y": 904.0},
                {"x": 790.0, "y": 902.0},
                {"x": 798.0, "y": 894.0},
                {"x": 798.0, "y": 892.0},
                {"x": 806.0, "y": 884.0},
                {"x": 806.0, "y": 882.0},
                {"x": 810.0, "y": 878.0},
                {"x": 812.0, "y": 878.0},
                {"x": 814.0, "y": 876.0},
                {"x": 814.0, "y": 874.0},
                {"x": 818.0, "y": 870.0},
                {"x": 820.0, "y": 870.0},
                {"x": 822.0, "y": 868.0},
                {"x": 822.0, "y": 866.0},
                {"x": 826.0, "y": 862.0},
                {"x": 828.0, "y": 862.0},
                {"x": 830.0, "y": 860.0},
                {"x": 830.0, "y": 858.0},
                {"x": 838.0, "y": 850.0},
                {"x": 838.0, "y": 844.0},
                {"x": 846.0, "y": 836.0},
                {"x": 846.0, "y": 830.0},
                {"x": 848.0, "y": 828.0},
                {"x": 848.0, "y": 826.0},
                {"x": 854.0, "y": 820.0},
                {"x": 854.0, "y": 810.0},
                {"x": 860.0, "y": 804.0},
                {"x": 860.0, "y": 802.0},
                {"x": 862.0, "y": 800.0},
                {"x": 862.0, "y": 794.0},
                {"x": 866.0, "y": 790.0},
                {"x": 868.0, "y": 790.0},
                {"x": 870.0, "y": 788.0},
                {"x": 870.0, "y": 784.0},
                {"x": 872.0, "y": 782.0},
                {"x": 872.0, "y": 780.0},
                {"x": 878.0, "y": 774.0},
                {"x": 878.0, "y": 770.0},
                {"x": 882.0, "y": 766.0},
                {"x": 884.0, "y": 766.0},
                {"x": 886.0, "y": 764.0},
                {"x": 886.0, "y": 756.0},
                {"x": 892.0, "y": 750.0},
                {"x": 900.0, "y": 750.0},
                {"x": 904.0, "y": 754.0},
                {"x": 904.0, "y": 756.0},
                {"x": 906.0, "y": 758.0},
                {"x": 908.0, "y": 758.0},
                {"x": 912.0, "y": 762.0},
                {"x": 912.0, "y": 764.0},
                {"x": 914.0, "y": 764.0},
                {"x": 916.0, "y": 766.0},
                {"x": 956.0, "y": 766.0},
                {"x": 958.0, "y": 764.0},
                {"x": 962.0, "y": 764.0},
                {"x": 966.0, "y": 760.0},
                {"x": 968.0, "y": 760.0},
                {"x": 970.0, "y": 758.0},
                {"x": 978.0, "y": 758.0},
                {"x": 980.0, "y": 756.0},
                {"x": 982.0, "y": 756.0},
                {"x": 988.0, "y": 750.0},
                {"x": 998.0, "y": 750.0},
                {"x": 1000.0, "y": 748.0},
                {"x": 1004.0, "y": 748.0},
                {"x": 1004.0, "y": 746.0},
                {"x": 1012.0, "y": 738.0},
                {"x": 1012.0, "y": 736.0},
                {"x": 1000.0, "y": 736.0},
                {"x": 998.0, "y": 738.0},
                {"x": 984.0, "y": 738.0},
                {"x": 982.0, "y": 740.0},
                {"x": 980.0, "y": 740.0},
                {"x": 978.0, "y": 742.0},
                {"x": 976.0, "y": 742.0},
                {"x": 974.0, "y": 744.0},
                {"x": 966.0, "y": 744.0},
                {"x": 964.0, "y": 746.0},
                {"x": 960.0, "y": 746.0},
                {"x": 958.0, "y": 748.0},
                {"x": 956.0, "y": 748.0},
                {"x": 954.0, "y": 750.0},
                {"x": 952.0, "y": 750.0},
                {"x": 950.0, "y": 752.0},
                {"x": 922.0, "y": 752.0},
                {"x": 918.0, "y": 748.0},
                {"x": 918.0, "y": 738.0},
                {"x": 924.0, "y": 732.0},
                {"x": 924.0, "y": 728.0},
                {"x": 926.0, "y": 726.0},
                {"x": 926.0, "y": 720.0},
                {"x": 928.0, "y": 718.0},
                {"x": 928.0, "y": 714.0},
                {"x": 930.0, "y": 712.0},
                {"x": 932.0, "y": 712.0},
                {"x": 932.0, "y": 710.0},
                {"x": 934.0, "y": 708.0},
                {"x": 934.0, "y": 700.0},
                {"x": 942.0, "y": 692.0},
                {"x": 942.0, "y": 682.0},
                {"x": 946.0, "y": 678.0},
                {"x": 948.0, "y": 678.0},
                {"x": 950.0, "y": 676.0},
                {"x": 950.0, "y": 664.0},
                {"x": 952.0, "y": 662.0},
                {"x": 952.0, "y": 658.0},
                {"x": 954.0, "y": 656.0},
                {"x": 956.0, "y": 656.0},
                {"x": 956.0, "y": 654.0},
                {"x": 958.0, "y": 652.0},
                {"x": 958.0, "y": 642.0},
                {"x": 960.0, "y": 640.0},
                {"x": 960.0, "y": 638.0},
                {"x": 964.0, "y": 634.0},
                {"x": 964.0, "y": 632.0},
                {"x": 966.0, "y": 630.0},
                {"x": 966.0, "y": 626.0},
                {"x": 972.0, "y": 620.0},
                {"x": 972.0, "y": 618.0},
                {"x": 974.0, "y": 616.0},
                {"x": 974.0, "y": 608.0},
                {"x": 980.0, "y": 602.0},
                {"x": 980.0, "y": 598.0},
                {"x": 982.0, "y": 596.0},
                {"x": 982.0, "y": 578.0},
                {"x": 986.0, "y": 574.0},
                {"x": 988.0, "y": 574.0},
                {"x": 988.0, "y": 572.0},
                {"x": 990.0, "y": 570.0},
                {"x": 990.0, "y": 562.0},
                {"x": 994.0, "y": 558.0},
                {"x": 996.0, "y": 558.0},
                {"x": 998.0, "y": 556.0},
                {"x": 998.0, "y": 532.0},
                {"x": 1000.0, "y": 530.0},
                {"x": 1000.0, "y": 528.0},
                {"x": 1004.0, "y": 524.0},
                {"x": 1004.0, "y": 520.0},
                {"x": 1006.0, "y": 518.0},
                {"x": 1006.0, "y": 504.0},
                {"x": 1008.0, "y": 502.0},
                {"x": 1008.0, "y": 498.0},
                {"x": 1010.0, "y": 496.0},
                {"x": 1012.0, "y": 496.0},
                {"x": 1012.0, "y": 494.0},
                {"x": 1014.0, "y": 492.0},
                {"x": 1014.0, "y": 482.0},
                {"x": 1018.0, "y": 478.0},
                {"x": 1020.0, "y": 478.0},
                {"x": 1022.0, "y": 476.0},
                {"x": 1022.0, "y": 450.0},
                {"x": 1020.0, "y": 448.0},
                {"x": 1018.0, "y": 448.0},
                {"x": 1014.0, "y": 444.0},
                {"x": 1014.0, "y": 440.0},
                {"x": 1010.0, "y": 436.0},
                {"x": 1010.0, "y": 432.0},
                {"x": 1012.0, "y": 430.0},
                {"x": 1012.0, "y": 424.0},
                {"x": 1014.0, "y": 422.0},
                {"x": 1014.0, "y": 418.0},
                {"x": 1022.0, "y": 410.0},
                {"x": 1022.0, "y": 388.0},
                {"x": 1018.0, "y": 384.0},
                {"x": 1004.0, "y": 384.0},
                {"x": 1002.0, "y": 382.0},
                {"x": 1000.0, "y": 382.0},
                {"x": 998.0, "y": 380.0},
                {"x": 998.0, "y": 368.0},
                {"x": 1000.0, "y": 366.0},
                {"x": 1000.0, "y": 364.0},
                {"x": 1004.0, "y": 360.0},
                {"x": 1004.0, "y": 352.0},
                {"x": 1000.0, "y": 348.0},
                {"x": 1000.0, "y": 346.0},
                {"x": 998.0, "y": 346.0},
                {"x": 996.0, "y": 344.0},
                {"x": 994.0, "y": 344.0},
                {"x": 990.0, "y": 340.0},
                {"x": 990.0, "y": 338.0},
                {"x": 988.0, "y": 336.0},
                {"x": 980.0, "y": 336.0},
                {"x": 978.0, "y": 334.0},
            ],
            "class_id": 6,
            "image_path": "data/subset/photo_2023-05-29-12-28-37-1-_jpeg_jpg.rf.8e5d19cd76994a1a6e09862b32f878b6.jpg",
            "prediction_type": "InstanceSegmentationModel",
        },
        {
            "x": 80.0,
            "y": 642.5,
            "width": 158.0,
            "height": 1255.0,
            "confidence": 0.8221669793128967,
            "class": "sneaker",
            "points": [
                {"x": 2.0, "y": 16.0},
                {"x": 2.0, "y": 1268.0},
                {"x": 158.0, "y": 1268.0},
                {"x": 158.0, "y": 16.0},
            ],
            "class_id": 6,
            "image_path": "data/subset/photo_2023-05-29-12-28-37-1-_jpeg_jpg.rf.8e5d19cd76994a1a6e09862b32f878b6.jpg",
            "prediction_type": "InstanceSegmentationModel",
        },
    ],
    "image": {"width": "1280", "height": "1280"},
}

roi = extract_roi(segmentation_data)

# Get the dominant color
dominant_color = get_dominant_color(roi)

# Print the dominant color in RGB format
print(
    f"Dominant Color: RGB({dominant_color[0]}, {dominant_color[1]}, {dominant_color[2]})"
)
